<form [formGroup]="medicalInfoForm" class="space-y-4 mt-4">
  <!-- Alergias -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Alergias
    </label>
    <textarea
      formControlName="allergies"
      rows="3"
      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
      placeholder="Liste cualquier alergia conocida (alimentos, medicamentos, ambientales)"
    ></textarea>
  </div>

  <!-- Medicamentos Actuales -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Medicamentos Actuales
    </label>
    <textarea
      formControlName="medications"
      rows="3"
      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
      placeholder="Liste cualquier medicamento que esté tomando actualmente"
    ></textarea>
  </div>

  <!-- Condiciones Médicas -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Condiciones Médicas
    </label>
    <textarea
      formControlName="medicalConditions"
      rows="3"
      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
      placeholder="Liste cualquier condición médica o preocupación"
    ></textarea>
  </div>

  <!-- Restricciones Alimentarias -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Restricciones Alimentarias
    </label>
    <textarea
      formControlName="dietaryRestrictions"
      rows="2"
      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
      placeholder="Liste cualquier restricción o preferencia alimentaria"
    ></textarea>
  </div>

  <div class="border-t pt-4 mt-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Contacto de Emergencia</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Nombre del Contacto de Emergencia -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Nombre del Contacto <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          formControlName="emergencyContactName"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Nombre del contacto de emergencia"
        />
        @if (medicalInfoForm.get('emergencyContactName')?.invalid && medicalInfoForm.get('emergencyContactName')?.touched) {
          <span class="text-xs text-red-600 mt-1">El nombre del contacto de emergencia es requerido</span>
        }
      </div>

      <!-- Teléfono del Contacto de Emergencia -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Teléfono del Contacto <span class="text-red-500">*</span>
        </label>
        <input
          type="tel"
          formControlName="emergencyContactPhone"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="+56 9 1234 5678"
        />
        @if (medicalInfoForm.get('emergencyContactPhone')?.invalid && medicalInfoForm.get('emergencyContactPhone')?.touched) {
          <span class="text-xs text-red-600 mt-1">El teléfono válido es requerido</span>
        }
      </div>

      <!-- Relación del Contacto de Emergencia -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Relación <span class="text-red-500">*</span>
        </label>
        <select
          formControlName="emergencyContactRelationship"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
        >
          <option value="">Seleccione relación</option>
          <option value="Padre/Madre">Padre/Madre</option>
          <option value="Tutor/a">Tutor/a</option>
          <option value="Esposo/a">Esposo/a</option>
          <option value="Hermano/a">Hermano/a</option>
          <option value="Otro">Otro</option>
        </select>
        @if (medicalInfoForm.get('emergencyContactRelationship')?.invalid && medicalInfoForm.get('emergencyContactRelationship')?.touched) {
          <span class="text-xs text-red-600 mt-1">La relación es requerida</span>
        }
      </div>
    </div>
  </div>

  <div class="border-t pt-4 mt-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Información del Seguro (Opcional)</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Proveedor de Seguro -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Proveedor de Seguro
        </label>
        <input
          type="text"
          formControlName="insuranceProvider"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Nombre de la compañía de seguros"
        />
      </div>

      <!-- Número de Póliza -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Número de Póliza
        </label>
        <input
          type="text"
          formControlName="insurancePolicyNumber"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Número de póliza"
        />
      </div>
    </div>
  </div>

  <!-- Navegación -->
  <div class="flex justify-between mt-6">
    <button
      mat-raised-button
      (click)="onBack()"
      type="button"
      class="!px-6"
    >
      <mat-icon class="mr-2">arrow_back</mat-icon>
      Atrás
    </button>

    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      type="button"
      [disabled]="medicalInfoForm.invalid || isSubmitting()"
      class="!px-6"
    >
      @if (isSubmitting()) {
        <span>Enviando...</span>
      } @else {
        <span>Enviar Registro</span>
      }
    </button>
  </div>
</form>
